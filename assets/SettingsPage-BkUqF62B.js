import{j as e,B as s,D as t,E as a,G as r,aj as l,V as n,ak as i,al as d,am as c}from"./ui-CKu8JIXp.js";import{r as m,N as x}from"./vendor-C0qp8t1d.js";import{a as o,u as h,h as u}from"./index-C7zud3iY.js";import{u as j}from"./i18n-BqTtoiWo.js";import{j as p,E as g,F as v,u as N,B as f,J as b,r as y,q as w,R as q}from"./icons-CWPu_Ox_.js";function C(e,s){if(e.variableName!==s.variableName)return!1;if(e.date.year!==s.date.year||e.date.month!==s.date.month||e.date.day!==s.date.day)return!1;if(e.pressureLevels.length!==s.pressureLevels.length)return!1;for(let t=0;t<e.pressureLevels.length;t++)if(e.pressureLevels[t]!==s.pressureLevels[t])return!1;return e.areaCovered.north===s.areaCovered.north&&e.areaCovered.south===s.areaCovered.south&&e.areaCovered.east===s.areaCovered.east&&e.areaCovered.west===s.areaCovered.west&&e.format===s.format}const L=({children:s,className:t=""})=>e.jsx("span",{className:`inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium ${t}`,children:s}),$=e=>`${e.year}-${String(e.month).padStart(2,"0")}-${String(e.day).padStart(2,"0")}`,S=e=>`N:${e.north}, S:${e.south}, E:${e.east}, W:${e.west}`,z=e=>{switch(e){case"completed":return"text-green-600";case"failed":return"text-red-600";case"processing":return"text-orange-600";default:return"text-blue-600"}},D=(s,t)=>0===s.length?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"text-gray-400 mb-2",children:e.jsx(g,{size:48,className:"mx-auto"})}),e.jsx("p",{className:"text-gray-600",children:t("settings.noRequests")}),e.jsx("a",{href:"/requests",className:"inline-block mt-3 px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 transition-colors",children:t("settings.makeRequest")})]}):e.jsx("div",{children:s.map((s=>e.jsx(A,{group:s},s.request.id)))}),A=({group:s})=>{const{t:t}=j(),[a,r]=m.useState(!1),{request:l,count:n}=s;return e.jsx("div",{className:"border rounded-md overflow-hidden mb-4",children:e.jsxs(i,{open:a,onOpenChange:r,children:[e.jsx(d,{asChild:!0,children:e.jsxs("div",{className:"flex flex-col md:flex-row md:justify-between md:items-center p-4 bg-white cursor-pointer hover:bg-gray-50",children:[e.jsxs("div",{className:"flex-1 mb-2 md:mb-0",children:[e.jsxs("h3",{className:"font-medium flex items-center",children:[e.jsx(v,{className:"mr-2 text-blue-500",size:18}),e.jsx("span",{children:l.variableName}),n>1&&e.jsxs(L,{className:"ml-2 bg-blue-100 text-blue-800",children:["x",n]})]}),e.jsxs("div",{className:"flex flex-wrap gap-x-4 text-sm text-gray-500 mt-1",children:[e.jsxs("span",{className:"flex items-center",children:[e.jsx(N,{className:"mr-1",size:14}),$(l.date)]}),e.jsxs("span",{className:"flex items-center",children:[e.jsx(f,{className:"mr-1",size:14}),(o=l.pressureLevels,0===o.length?"None":o.length<=3?o.join(", "):`${o.length} levels`)]}),e.jsxs("span",{className:"flex items-center",children:[e.jsx(b,{className:"mr-1",size:14}),S(l.areaCovered)]})]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"text-sm text-gray-500 mr-4",children:(x=l.createdAt,new Date(x).toLocaleDateString())}),e.jsx("button",{className:"text-blue-600 hover:text-blue-800 transition-colors",children:a?e.jsx(y,{size:20}):e.jsx(w,{size:20})})]})]})}),e.jsx(c,{className:"bg-gray-50 p-4 border-t",children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-medium",children:t("requests.details")}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:t("requests.variableName")}),e.jsx("p",{children:l.variableName})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:t("requests.date")}),e.jsx("p",{children:$(l.date)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:t("requests.pressureLevels")}),e.jsx("p",{children:l.pressureLevels.join(", ")||t("common.none")})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:t("requests.areaCovered")}),e.jsx("p",{children:S(l.areaCovered)})]}),l.format&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:t("requests.format")}),e.jsx("p",{children:l.format})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:t("requests.status")}),e.jsx("p",{className:`${z(l.status)}`,children:t(`requests.statuses.${l.status}`)})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500",children:t("requests.created")}),e.jsx("p",{children:new Date(l.createdAt).toLocaleString()})]})]}),e.jsx("div",{className:"pt-3 border-t mt-3",children:e.jsxs("button",{className:"flex items-center gap-2 px-3 py-1.5 text-sm bg-blue-500 text-white rounded-md hover:bg-blue-600 transition-colors",children:[e.jsx(q,{size:14}),e.jsx("span",{children:t("requests.requestAgain")})]})})]})})]})});var x,o},E=()=>{const{t:i}=j(),d=o(),{isAuthenticated:c,user:g}=h((e=>e.auth)),{items:v,isLoading:N,error:f}=h((e=>e.viewRequests)),[b,y]=m.useState(!1),w=function(e){const s=[...e].sort(((e,s)=>new Date(s.createdAt).getTime()-new Date(e.createdAt).getTime())),t=[],a=new Set;for(let r=0;r<s.length;r++){if(a.has(r))continue;const e=s[r];let l=1;for(let t=r+1;t<s.length;t++)C(e,s[t])&&(l++,a.add(t));t.push({request:e,count:l})}return t}(v);return m.useEffect((()=>{d(u())}),[d]),m.useEffect((()=>{f&&y(!0)}),[f]),c&&g?e.jsxs(s,{swipeDirection:"right",children:[e.jsxs("div",{className:"max-w-4xl mx-auto p-4",children:[e.jsx("h1",{className:"text-2xl font-bold mb-6",children:i("settings.title")}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6 mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:i("settings.requestsHistory")}),N?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"inline-block w-6 h-6 border-2 border-gray-300 border-t-blue-500 rounded-full animate-spin"}),e.jsx("p",{className:"mt-2 text-gray-600",children:i("common.loading")})]}):D(w,i)]})]}),e.jsxs(t,{className:"fixed bottom-4 right-4 p-4 rounded-md shadow-md max-w-sm bg-red-50 border border-red-200 data-[state=open]:animate-slideIn data-[state=closed]:animate-slideOut",open:b,onOpenChange:y,children:[e.jsxs(a,{className:"font-medium text-red-800 flex items-center gap-2",children:[e.jsx(p,{size:16}),i("toast.error")]}),e.jsx(r,{className:"text-red-700",children:f}),e.jsx(l,{className:"absolute top-2 right-2 text-gray-400 hover:text-gray-600",children:"Ã—"})]}),e.jsx(n,{})]}):e.jsx(x,{to:"/auth",replace:!0})};export{E as default};
